<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="group.jsjxh.community.dao.UserDao">
    <sql id="table">
        tb_user
    </sql>
    <sql id="showField">
        tb_user.id,
        tb_user.ACCOUNT_ID,tb_user .NAME,tb_user .TOKEN,tb_user.CREATE_AT,tb_user.UPDATE_AT
        FROM <include refid="table"/>
    </sql>
    <resultMap id="userMap" type="group.jsjxh.community.bean.User">
        <result property="id" column="id"/>
        <result property="account_id" column="ACCOUNT_ID" jdbcType="BIGINT"/>
        <result property="name" column="NAME" jdbcType="VARCHAR"/>
        <result property="token" column="TOKEN"/>
        <result property="create_at" javaType="java.util.Date" column="CREATE_AT" jdbcType="TIMESTAMP"/>
        <result property="update_at" javaType="java.util.Date" column="UPDATE_AT" jdbcType="TIMESTAMP"/>
    </resultMap>
    <parameterMap id="paramMap" type="User">
        <parameter property="account_id" javaType="long" jdbcType="BIGINT"/>
        <parameter property="name" javaType="String" jdbcType="VARCHAR"/>
        <parameter property="token" javaType="String" jdbcType="CHAR"/>
        <parameter property="create_at" javaType="Date" jdbcType="TIMESTAMP"/>
        <parameter property="update_at" javaType="Date" jdbcType="TIMESTAMP"/>
    </parameterMap>
    <select id="findUserByToken" parameterType="java.lang.String" resultType="group.jsjxh.community.bean.User" resultMap="userMap">
        SELECT
        <include refid="showField"/>
        WHERE tb_user .token=#{token}
    </select>

    <select id="findUserByAccount_id" parameterType="Long" resultType="User" resultMap="userMap">
        select
        <include refid="showField"/>
        where tb_user.account_id=#{account_id}
    </select>
    <insert id="saveUser" parameterType="group.jsjxh.community.bean.User" keyProperty="id" useGeneratedKeys="true">
        insert into tb_user values(default,#{account_id},#{name},#{token},now() ,now(),#{picUrl})
    </insert>

    <update id="updateToken" parameterType="User">
        update
        <include refid="table"/>
        set
        token='${token}' , update_at=#{update_at}   <!--更新uuid时 若不打引号，会出现unknow column -->
        where
        account_id=#{account_id}
    </update>
</mapper>